import{_ as L,a as V,b as $,c as E,d as H,e as U}from"./C_oc3ba4.js";import{d as j,a8 as G,n as O,m as z,X as K,B as v,K as k,A as X,y as J,C as Q,z as W,I as A,c as g,h as f,a as i,i as P,e as a,b as D,w as Y,o as l,t as w,g as N}from"./CyBGr-YO.js";import"./CO4MXo0O.js";import"./DDYUcn6y.js";import"./DXb2HN8e.js";import"./CIAHthuC.js";const Z={class:"container px-2"},ee={key:0,class:"flex items-start gap-16"},te={class:"w-full"},oe={class:"flex items-center justify-between w-full gap-4 mt-8 md:gap-8"},ae={key:1,class:"py-16 text-center"},se={class:"text-center"},re={class:"text-xl font-bold mb-4"},ne={key:0,class:"mt-4 text-sm text-gray-600 border p-4 rounded text-left inline-block"},le={key:1,class:"mt-4 text-sm text-gray-600"},ye=j({__name:"[slug]",async setup(ie){let b,C;const{loadProductsForPage:M,updateProductList:S,products:q,getCurrentPageFromRoute:B,isLoading:F}=G();O();const{storeSettings:h}=z(),e=K();let r="";if(e.params&&"categorySlug"in e.params&&e.params.categorySlug&&(r=typeof e.params.categorySlug=="string"?e.params.categorySlug:String(e.params.categorySlug)),!r&&e.params&&"slug"in e.params&&e.params.slug&&(r=typeof e.params.slug=="string"?e.params.slug:String(e.params.slug)),!r&&e.path){const s=e.path.split("/"),t=s.findIndex(n=>n==="produkt-kategoriya");if(t!==-1&&s[t+1]&&s[t+1]!=="page"){const n=s[t+1];n&&(r=n)}}let c=r;try{r&&(c=decodeURIComponent(r))}catch(s){console.error("Грешка при декодиране на URL:",s)}const u=v(r),o=v(null),m=v(c||"All Products"),y=v(`Products in category ${c||"All Products"}`);k({title:m.value,meta:[{name:"description",content:y.value}]});const I=X(()=>({categoryIn:u.value?[u.value]:void 0,search:e.query.search,priceMin:e.query.priceMin?parseFloat(e.query.priceMin):void 0,priceMax:e.query.priceMax?parseFloat(e.query.priceMax):void 0,onSale:e.query.sale==="true"?!0:void 0,orderby:e.query.orderby||"DATE",order:e.query.order||"DESC",rating:e.query.rating?[parseInt(e.query.rating,10)]:void 0})),R=B();return[b,C]=J(()=>M(R,I.value)),await b,C(),Q(async()=>{var s,t,n,_;try{const{data:d}=await W("getProductCategories"),x=((t=(s=d.value)==null?void 0:s.productCategories)==null?void 0:t.nodes)||[];u.value&&(o.value=x.find(p=>p.slug&&(p.slug===u.value||p.slug===c))||null),(n=o.value)!=null&&n.seo&&(m.value=o.value.seo.title||o.value.name||c||"All Products",y.value=o.value.seo.metaDesc||o.value.description||`Products in category ${o.value.name||c||"All Products"}`,k({title:m.value,meta:[{name:"description",content:y.value},{property:"og:title",content:o.value.seo.opengraphTitle||m.value},{property:"og:description",content:o.value.seo.opengraphDescription||y.value}],link:[{rel:"canonical",href:o.value.seo.canonical||""}]}),(_=o.value.seo.schema)!=null&&_.raw&&k({script:[{type:"application/ld+json",innerHTML:o.value.seo.schema.raw}]}))}catch(d){console.warn("Не можахме да заредим категориите (очаквано при първо зареждане):",d)}}),A(()=>e.query,()=>{e.name!=="produkt-kategoriya-slug"&&e.name!=="produkt-kategoriya-page-pager"||S()}),A(()=>e.params,()=>{e.name!=="produkt-kategoriya-slug"&&e.name!=="produkt-kategoriya-page-pager"||S()}),(s,t)=>{const n=E,_=V,d=H,x=U,p=$,T=L;return l(),g("div",Z,[!i(F)&&i(q)&&i(q).length?(l(),g("div",ee,[i(h).showFilters?(l(),f(n,{key:0,"hide-categories":!0})):P("",!0),a("div",te,[a("div",oe,[D(_),i(h).showOrderByDropdown?(l(),f(d,{key:0,class:"hidden md:inline-flex"})):P("",!0),i(h).showFilters?(l(),f(x,{key:1,class:"md:hidden"})):P("",!0)]),D(p)])])):i(F)?(l(),g("div",ae,t[0]||(t[0]=[a("div",{class:"inline-block p-4 text-gray-500"},[a("div",{class:"h-8 w-8 border-t-2 border-primary border-solid rounded-full mx-auto animate-spin mb-4"}),a("p",null,"Зареждане на продукти...")],-1)]))):(l(),f(T,{key:2},{default:Y(()=>[a("div",se,[a("h2",re,w(u.value?"No products found in this category.":"All Products"),1),u.value?(l(),g("div",ne,[a("p",null,[t[1]||(t[1]=a("strong",null,"URL slug:",-1)),N(" "+w(u.value||"Not provided"),1)]),a("p",null,[t[2]||(t[2]=a("strong",null,"Decoded slug:",-1)),N(" "+w(i(c)||"Not decoded"),1)])])):(l(),g("div",le,t[3]||(t[3]=[a("p",null,"Please select a category from the menu.",-1)])))])]),_:1}))])}}});export{ye as default};
