import{_ as Z,a as ee,b as te,c as oe,d as ae,e as se}from"./DeKbuFmy.js";import{d as re,a6 as ne,n as ce,m as le,X as ue,B as c,y as ie,A as pe,C as de,I as R,K as I,c as L,h as y,a as i,i as h,e as E,b as H,z as ge,o as l}from"./wATBLoar.js";import"./_I1vECoG.js";import"./ne4CjYMk.js";import"./iE6mmDyv.js";import"./s2QRskNS.js";import"./XVzLf75K.js";const me={class:"container px-2"},_e={key:0,class:"flex items-start gap-16"},ye={class:"w-full"},he={class:"flex items-center justify-between w-full gap-4 mt-8 md:gap-8"};const be=re({__name:"[slug]",async setup(fe){var v,x,k,w,P,C,N,B,S,F,V,b,q,D,M,T;let u,f;const{updateProductList:p,products:U,loadProductsForPage:$,getCurrentPageFromRoute:j}=ne(),{isQueryEmpty:G}=ce(),{storeSettings:d}=le(),e=ue(),O=c(!0);console.log("Текущ route:",{fullPath:e.fullPath,path:e.path,name:e.name,params:e.params});let o="";if(e.params&&e.params.categorySlug&&(o=typeof e.params.categorySlug=="string"?e.params.categorySlug:String(e.params.categorySlug)),!o&&e.params&&e.params.slug&&(o=typeof e.params.slug=="string"?e.params.slug:String(e.params.slug)),!o&&e.path){const t=e.path.split("/"),s=t.findIndex(r=>r==="produkt-kategoriya");if(s!==-1&&t[s+1]&&t[s+1]!=="page"){const r=t[s+1];r&&(o=r)}}console.log("Извлечен slug:",o),o?console.log("Slug от URL (преди декодиране):",o):console.log("Използваме всички продукти, тъй като slug е празен");let n=o;try{o&&(n=decodeURIComponent(o),console.log("Декодиран slug:",n))}catch(t){console.error("Грешка при декодиране на URL:",t)}const g=c(o),a=c(null),m=c(""),_=c(""),{data:z}=([u,f]=ie(()=>ge("getProductCategories")),u=await u,f(),u),K=pe(()=>{var t,s;return((s=(t=z.value)==null?void 0:t.productCategories)==null?void 0:s.nodes)||[]});g.value&&(a.value=K.value.find(t=>t.slug&&(t.slug===g.value||t.slug===n))||null,console.log("Намерена категория:",a.value));const Q={categoryIn:[g.value],search:e.query.search,priceMin:e.query.priceMin?parseFloat(e.query.priceMin):void 0,priceMax:e.query.priceMax?parseFloat(e.query.priceMax):void 0,onSale:e.query.sale==="true"?!0:void 0,orderby:e.query.orderby||"DATE"};return de(async()=>{const t=j();await $(t,Q),G.value||p()}),setTimeout(()=>{O.value=!1},500),R(()=>e.query,()=>{e.name!=="produkt-kategoriya-slug"&&e.name!=="produkt-kategoriya-page-pager"||p()}),R(()=>e.params,()=>{e.name!=="produkt-kategoriya-slug"&&e.name!=="produkt-kategoriya-page-pager"||p()}),m.value=((x=(v=a.value)==null?void 0:v.seo)==null?void 0:x.title)||((k=a.value)==null?void 0:k.name)||n||"All Products",_.value=((P=(w=a.value)==null?void 0:w.seo)==null?void 0:P.metaDesc)||((C=a.value)==null?void 0:C.description)||`Products in category ${((N=a.value)==null?void 0:N.name)||n||"All Products"}`,I({title:m.value,meta:[{name:"description",content:_.value},{property:"og:title",content:((S=(B=a.value)==null?void 0:B.seo)==null?void 0:S.opengraphTitle)||m.value},{property:"og:description",content:((V=(F=a.value)==null?void 0:F.seo)==null?void 0:V.opengraphDescription)||_.value}],link:[{rel:"canonical",href:((q=(b=a.value)==null?void 0:b.seo)==null?void 0:q.canonical)||""}]}),(T=(M=(D=a.value)==null?void 0:D.seo)==null?void 0:M.schema)!=null&&T.raw&&I({script:[{type:"application/ld+json",innerHTML:a.value.seo.schema.raw}]}),(t,s)=>{var A;const r=oe,X=ee,J=ae,W=se,Y=te,ve=Z;return l(),L("div",me,[((A=i(U))!=null&&A.length,l(),L("div",_e,[i(d).showFilters?(l(),y(r,{key:0,"hide-categories":!0})):h("",!0),E("div",ye,[E("div",he,[H(X),i(d).showOrderByDropdown?(l(),y(J,{key:0,class:"hidden md:inline-flex"})):h("",!0),i(d).showFilters?(l(),y(W,{key:1,class:"md:hidden"})):h("",!0)]),H(Y)])]))])}}});export{be as default};
