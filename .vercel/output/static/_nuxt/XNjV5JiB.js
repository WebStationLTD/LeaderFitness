import{_ as te,a as oe,b as re,c as ae,d as se,e as ne}from"./9TxeAfjS.js";import{d as le,a8 as ue,n as ce,m as ie,X as pe,B as g,y,A as de,C as ge,I as j,K as G,c as m,h as _,a as d,i as w,e as s,b as O,w as me,z as ye,o as l,t as M,g as z}from"./86dFGjsn.js";import"./CqKe_Vxy.js";import"./MMw8a0Mt.js";import"./TQp3UGqg.js";import"./BOC87lRb.js";const _e={class:"container px-2"},ve={key:0,class:"flex items-start gap-16"},fe={class:"w-full"},he={class:"flex items-center justify-between w-full gap-4 mt-8 md:gap-8"},xe={key:1,class:"py-16 text-center"},ke={class:"text-center"},qe={class:"text-xl font-bold mb-4"},Pe={key:0,class:"mt-4 text-sm text-gray-600 border p-4 rounded text-left inline-block"},we={key:1,class:"mt-4 text-sm text-gray-600"},Ae=le({__name:"[slug]",async setup(Me){var F,S,C,D,N,A,T,B,L,R,I,E,U,V,$,H;let n,u;const{updateProductList:v,products:b,loadProductsForPage:f,getCurrentPageFromRoute:h}=ue(),{isQueryEmpty:K}=ce(),{storeSettings:x}=ie(),e=pe(),k=g(!0);console.log("Текущ route:",{fullPath:e.fullPath,path:e.path,name:e.name,params:e.params});let a="";if(e.params&&e.params.categorySlug&&(a=typeof e.params.categorySlug=="string"?e.params.categorySlug:String(e.params.categorySlug)),!a&&e.params&&e.params.slug&&(a=typeof e.params.slug=="string"?e.params.slug:String(e.params.slug)),!a&&e.path){const t=e.path.split("/"),o=t.findIndex(p=>p==="produkt-kategoriya");if(o!==-1&&t[o+1]&&t[o+1]!=="page"){const p=t[o+1];p&&(a=p)}}console.log("Извлечен slug:",a),a?console.log("Slug от URL (преди декодиране):",a):console.log("Използваме всички продукти, тъй като slug е празен");let i=a;try{a&&(i=decodeURIComponent(a),console.log("Декодиран slug:",i))}catch(t){console.error("Грешка при декодиране на URL:",t)}const c=g(a),r=g(null),q=g(""),P=g(""),{data:Q}=([n,u]=y(()=>ye("getProductCategories")),n=await n,u(),n),X=de(()=>{var t,o;return((o=(t=Q.value)==null?void 0:t.productCategories)==null?void 0:o.nodes)||[]});if(c.value&&(r.value=X.value.find(t=>t.slug&&(t.slug===c.value||t.slug===i))||null,console.log("Намерена категория:",r.value)),r.value&&r.value.slug)try{const t={categoryIn:[r.value.slug],search:e.query.search,priceMin:e.query.priceMin?parseFloat(e.query.priceMin):void 0,priceMax:e.query.priceMax?parseFloat(e.query.priceMax):void 0,onSale:e.query.sale==="true"?!0:void 0,orderby:e.query.orderby||"DATE"},o=h();[n,u]=y(()=>f(o,t)),await n,u(),console.log(`Заредени продукти от категория ${r.value.slug} с pagination`)}catch(t){console.error("Грешка при зареждане на продукти:",t)}else if(c.value)try{const t={categoryIn:[c.value],search:e.query.search,priceMin:e.query.priceMin?parseFloat(e.query.priceMin):void 0,priceMax:e.query.priceMax?parseFloat(e.query.priceMax):void 0,onSale:e.query.sale==="true"?!0:void 0,orderby:e.query.orderby||"DATE"},o=h();[n,u]=y(()=>f(o,t)),await n,u()}catch(t){console.error("Грешка при зареждане на продукти по slug:",t)}else try{const t={search:e.query.search,priceMin:e.query.priceMin?parseFloat(e.query.priceMin):void 0,priceMax:e.query.priceMax?parseFloat(e.query.priceMax):void 0,onSale:e.query.sale==="true"?!0:void 0,orderby:e.query.orderby||"DATE"},o=h();[n,u]=y(()=>f(o,t)),await n,u()}catch(t){console.error("Грешка при зареждане на всички продукти:",t)}return setTimeout(()=>{k.value=!1},500),ge(()=>{K.value||v()}),j(()=>e.query,()=>{e.name!=="produkt-kategoriya-slug"&&e.name!=="produkt-kategoriya-page-pager"||v()}),j(()=>e.params,()=>{e.name!=="produkt-kategoriya-slug"&&e.name!=="produkt-kategoriya-page-pager"||v()}),q.value=((S=(F=r.value)==null?void 0:F.seo)==null?void 0:S.title)||((C=r.value)==null?void 0:C.name)||i||"All Products",P.value=((N=(D=r.value)==null?void 0:D.seo)==null?void 0:N.metaDesc)||((A=r.value)==null?void 0:A.description)||`Products in category ${((T=r.value)==null?void 0:T.name)||i||"All Products"}`,G({title:q.value,meta:[{name:"description",content:P.value},{property:"og:title",content:((L=(B=r.value)==null?void 0:B.seo)==null?void 0:L.opengraphTitle)||q.value},{property:"og:description",content:((I=(R=r.value)==null?void 0:R.seo)==null?void 0:I.opengraphDescription)||P.value}],link:[{rel:"canonical",href:((U=(E=r.value)==null?void 0:E.seo)==null?void 0:U.canonical)||""}]}),(H=($=(V=r.value)==null?void 0:V.seo)==null?void 0:$.schema)!=null&&H.raw&&G({script:[{type:"application/ld+json",innerHTML:r.value.seo.schema.raw}]}),(t,o)=>{const p=ae,J=oe,W=se,Y=ne,Z=re,ee=te;return l(),m("div",_e,[!k.value&&d(b)&&d(b).length?(l(),m("div",ve,[d(x).showFilters?(l(),_(p,{key:0,"hide-categories":!0})):w("",!0),s("div",fe,[s("div",he,[O(J),d(x).showOrderByDropdown?(l(),_(W,{key:0,class:"hidden md:inline-flex"})):w("",!0),d(x).showFilters?(l(),_(Y,{key:1,class:"md:hidden"})):w("",!0)]),O(Z)])])):k.value?(l(),m("div",xe,o[0]||(o[0]=[s("div",{class:"inline-block p-4 text-gray-500"},[s("div",{class:"h-8 w-8 border-t-2 border-primary border-solid rounded-full mx-auto animate-spin mb-4"}),s("p",null,"Loading products...")],-1)]))):(l(),_(ee,{key:2},{default:me(()=>[s("div",ke,[s("h2",qe,M(c.value?"No products found in this category.":"All Products"),1),c.value?(l(),m("div",Pe,[s("p",null,[o[1]||(o[1]=s("strong",null,"URL slug:",-1)),z(" "+M(c.value||"Not provided"),1)]),s("p",null,[o[2]||(o[2]=s("strong",null,"Decoded slug:",-1)),z(" "+M(d(i)||"Not decoded"),1)])])):(l(),m("div",we,o[3]||(o[3]=[s("p",null,"Please select a category from the menu.",-1)])))])]),_:1}))])}}});export{Ae as default};
