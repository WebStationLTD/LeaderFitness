import{d as B,c as a,o as s,b as j,w as D,e as g,i as h,t as m,g as T,F as N,r as $,f as L,v as V,B as P,a3 as S,z as k,a as f,K as q,y as A,h as I,q as F}from"./CyBGr-YO.js";const M={class:"flex flex-col overflow-hidden rounded-lg shadow transition-all hover:shadow-lg"},O={class:"aspect-w-16 aspect-h-9 w-full relative"},Q=["src","alt"],E={key:1,class:"h-48 w-full bg-gray-200 flex items-center justify-center"},U={class:"flex-1 bg-white p-6 flex flex-col justify-between"},z={class:"flex-1"},H={class:"flex items-center gap-2 text-sm text-gray-500 mb-2"},K=["datetime"],W={key:1,class:"inline-flex"},J={class:"text-xl font-semibold text-gray-900 hover:text-primary-600"},R={key:0,class:"mt-3 text-gray-600"},X={class:"mt-4"},Y={key:0,class:"flex items-center"},Z={key:0,class:"flex-shrink-0 mr-2"},tt=["src","alt"],et={key:1,class:"text-sm font-medium text-gray-900"},st=B({__name:"BlogPostCard",props:{post:{type:Object,required:!0}},setup(t){const c=n=>{if(!n)return"";const o=new Date(n);return new Intl.DateTimeFormat("bg-BG",{year:"numeric",month:"long",day:"numeric"}).format(o)},i=n=>{if(!n)return"";const l=n.replace(/<\/?[^>]+(>|$)/g,"").replace(/\[&hellip;\]|\[…\]/g,"...");return l.length>150?l.slice(0,150)+"...":l};return(n,o)=>{const l=L;return s(),a("article",M,[j(l,{to:`/blog/${t.post.slug}`,class:"block overflow-hidden"},{default:D(()=>{var u,p,x,_,e,d;return[g("div",O,[(p=(u=t.post.featuredImage)==null?void 0:u.node)!=null&&p.sourceUrl?(s(),a("img",{key:0,src:t.post.featuredImage.node.sourceUrl,alt:t.post.featuredImage.node.altText||t.post.title,class:"h-48 w-full object-cover transition-transform duration-200 ease-in-out hover:scale-105"},null,8,Q)):(s(),a("div",E,o[0]||(o[0]=[g("span",{class:"text-gray-400"},"Няма изображение",-1)])))]),g("div",U,[g("div",z,[g("div",H,[t.post.date?(s(),a("time",{key:0,datetime:t.post.date},m(c(t.post.date)),9,K)):h("",!0),(_=(x=t.post.categories)==null?void 0:x.nodes)!=null&&_.length?(s(),a("span",W,[o[1]||(o[1]=T(" • ")),(s(!0),a(N,null,$(t.post.categories.nodes,(r,v)=>(s(),a("span",{key:r.slug,class:"ml-1"},m(r.name)+m(v<t.post.categories.nodes.length-1?", ":""),1))),128))])):h("",!0)]),g("h3",J,m(t.post.title),1),t.post.excerpt?(s(),a("div",R,m(i(t.post.excerpt)),1)):h("",!0)]),g("div",X,[(e=t.post.author)!=null&&e.node?(s(),a("div",Y,[(d=t.post.author.node.avatar)!=null&&d.url?(s(),a("div",Z,[g("img",{class:"h-8 w-8 rounded-full",src:t.post.author.node.avatar.url,alt:t.post.author.node.name},null,8,tt)])):h("",!0),t.post.author.node.name?(s(),a("p",et,m(t.post.author.node.name),1)):h("",!0)])):h("",!0)])])]}),_:1},8,["to"])])}}}),ot=Object.assign(V(st,[["__scopeId","data-v-c2845411"]]),{__name:"BlogPostCard"}),G=()=>{const t=P([]),c=P(null),i=P(!1),n=P(null),o=S({hasNextPage:!1,endCursor:null}),l=e=>{e&&e.length>0&&(t.value=e)},u=e=>{e&&e.length>0&&(t.value=[...t.value,...e])},p=e=>{c.value=e};return{posts:t,currentPost:c,loading:i,error:n,pageInfo:o,setPosts:l,addPosts:u,setCurrentPost:p,loadMorePosts:async()=>{var e,d;if(o.hasNextPage){i.value=!0,n.value=null;try{const{data:r}=await k("GetBlogPosts",{first:12,after:o.endCursor});(d=(e=r.value)==null?void 0:e.posts)!=null&&d.nodes&&(u(r.value.posts.nodes),o.hasNextPage=r.value.posts.pageInfo.hasNextPage,o.endCursor=r.value.posts.pageInfo.endCursor)}catch(r){n.value=r.message||"Грешка при зареждане на публикации"}finally{i.value=!1}}},loadPostBySlug:async e=>{var d,r,v,y;i.value=!0,n.value=null;try{const{data:w}=await k("GetBlogPosts",{first:100}),C=(v=(r=(d=w.value)==null?void 0:d.posts)==null?void 0:r.nodes)==null?void 0:v.find(b=>b.slug===e);if(C){const{data:b}=await k("GetBlogPost",{id:C.id});if((y=b.value)!=null&&y.post)return p(b.value.post),b.value.post}return null}catch(w){return n.value=w.message||"Грешка при зареждане на публикацията",null}finally{i.value=!1}}}},at={key:0,class:"w-full mt-8 flex justify-center"},nt=["disabled"],lt={key:0},rt={key:1},it=B({__name:"BlogPagination",setup(t){const{loadMorePosts:c,loading:i,pageInfo:n}=G();return(o,l)=>f(n).hasNextPage?(s(),a("div",at,[g("button",{onClick:l[0]||(l[0]=(...u)=>f(c)&&f(c)(...u)),disabled:f(i),class:"rounded-lg px-4 py-2 bg-primary-600 text-white hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed"},[f(i)?(s(),a("span",lt,"Зареждане...")):(s(),a("span",rt,"Зареди още"))],8,nt)])):h("",!0)}}),ct=Object.assign(it,{__name:"BlogPagination"}),dt={class:"container py-8"},ut={class:"text-3xl sm:text-4xl font-bold text-center mb-8"},gt={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"},ft={key:1,class:"text-center p-8"},mt=B({__name:"index",async setup(t){var x,_;let c,i;const{setPosts:n,posts:o,pageInfo:l}=G();let u="Блог";q({title:u,meta:[{name:"description",content:"Всички публикации от нашия блог"}]});try{const{data:e}=([c,i]=A(()=>k("GetBlogPosts",{first:50})),c=await c,i(),c);(_=(x=e.value)==null?void 0:x.posts)!=null&&_.nodes&&(n(e.value.posts.nodes),e.value.posts.pageInfo&&(l.hasNextPage=e.value.posts.pageInfo.hasNextPage,l.endCursor=e.value.posts.pageInfo.endCursor))}catch(e){console.error("Грешка при зареждане на публикации:",e)}return(e,d)=>{const r=ot,v=ct;return s(),a("div",dt,[g("h1",ut,m(f(u)),1),f(o).length?(s(),a("div",gt,[(s(!0),a(N,null,$(f(o),y=>(s(),I(r,{key:y.id,post:y},null,8,["post"]))),128))])):(s(),a("div",ft,d[0]||(d[0]=[F('<h2 class="text-xl font-semibold">Няма намерени публикации</h2><p class="mt-2 text-gray-600">В момента няма публикации в блога</p><div class="mt-8 p-4 bg-yellow-50 rounded-lg text-left"><p class="font-semibold">Възможни причини:</p><ul class="list-disc pl-5 mt-2"><li>WPGraphQL плъгинът не е активиран</li><li>Публикациите (posts) не са достъпни през GraphQL API</li><li>Постовете са с неправилен статус (трябва да са published)</li><li>Има проблем с GraphQL ендпойнта или достъпа до него</li></ul></div>',3)]))),f(o).length&&f(l).hasNextPage?(s(),I(v,{key:2})):h("",!0)])}}});export{mt as default};
