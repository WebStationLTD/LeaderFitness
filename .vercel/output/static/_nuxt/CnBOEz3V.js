import{r as ae,f as ne,e as le,q as re,w as de,k as ie,a as ce,_ as ue,b as me}from"./B8LMokGs.js";import{_ as _e,a as pe}from"./44isg0tU.js";import{_ as fe}from"./DKMn0Wwy.js";import{O as he}from"./CzxjUVWS.js";import{q as ge,d as p,y as c,z as ye,u as xe,v as d,P as b,D as t,I as f,$ as i,O as e,J as u,Q as U,Z as o,X as ve,N as l}from"./BLv-qrLK.js";import"./BZpiv6Tl.js";const be={class:"w-full min-h-[600px] flex items-center p-4 text-gray-800 md:bg-white md:rounded-xl md:mx-auto md:shadow-lg md:my-24 md:mt-8 md:max-w-3xl md:p-16 flex-col"},we={key:0,class:"w-full"},ke={key:0,class:"flex items-center gap-4"},$e={class:"text-xl font-semibold"},Ie={class:"flex items-center justify-between w-full mb-2"},Te={class:"text-xl font-semibold"},je={key:1,class:"flex-1 w-full"},Ce={class:"flex items-start justify-between"},De={class:"w-[21%]"},Le={class:"mb-2 text-xs text-gray-400 uppercase"},Me={class:"leading-none"},Oe={class:"w-[21%]"},Pe={class:"mb-2 text-xs text-gray-400 uppercase"},Be={class:"leading-none"},Ne={class:"w-[21%]"},Se={class:"mb-2 text-xs text-gray-400 uppercase"},qe={class:"w-[21%]"},Ee={class:"mb-2 text-xs text-gray-400 uppercase"},Re={class:"leading-none"},ze={class:"grid gap-2"},He={class:"flex-1 leading-tight"},Ve={class:"text-sm text-gray-600"},Fe={class:"text-sm font-semibold"},Ge={key:1},Qe={class:"flex justify-between"},Ue={class:"flex justify-between"},Ae={class:"flex justify-between"},Je={key:0,class:"flex justify-between text-primary"},Xe={class:"flex justify-between"},Ze={class:""},Ke={class:"font-semibold"},We={key:2,class:"flex flex-col items-center justify-center flex-1 w-full gap-4 text-center"},Ye=["innerHTML"],es=2500,ds=ge({__name:"order-summary",setup(ss){const{query:_,params:A,name:w}=ae(),{customer:J}=ne(),{formatDate:X,formatPrice:Z}=le(),{t:k}=re(),n=p(null),K=p(_.fetch_delay==="true"),h=p(!1),m=p("");c(()=>{var s;return!((s=J.value)!=null&&s.email)});const $=c(()=>w==="order-summary"),g=c(()=>w==="order-received"),y=c(()=>{var s;return((s=n.value)==null?void 0:s.status)!==he.COMPLETED}),W=c(()=>{var s;return!!parseFloat(((s=n.value)==null?void 0:s.rawDiscountTotal)||"0")}),I=c(()=>{var s,a;return((a=(s=n.value)==null?void 0:s.downloadableItems)==null?void 0:a.nodes)||[]});ye(()=>{g.value&&(_.cancel_order||_.from_paypal||_.PayerID)&&window.close()}),xe(async()=>{await x(),g.value&&K.value&&y.value&&setTimeout(()=>{x()},es)});async function x(){var s;try{const a=await de({id:A.orderId});a.order?n.value=a.order:m.value="Could not find order"}catch(a){m.value=((s=a==null?void 0:a.gqlErrors)==null?void 0:s[0].message)||"Could not find order"}h.value=!0}const Y=async()=>{h.value=!1,await x()};return ie({title(){return $.value?k("messages.shop.orderSummary"):k("messages.shop.orderReceived")}}),(s,a)=>{const ee=me,v=ue,T=ce,se=_e,te=fe,oe=pe;return l(),d("div",be,[t(h)?(l(),d(f,{key:1},[t(n)?(l(),d("div",we,[t($)?(l(),d("div",ke,[u(T,{to:"/my-account?tab=orders",class:"inline-flex items-center justify-center p-2 border rounded-md",title:"Back to orders","aria-label":"Back to orders"},{default:U(()=>[u(v,{name:"ion:chevron-back-outline"})]),_:1}),e("h1",$e,o(s.$t("messages.shop.orderSummary")),1)])):t(g)?(l(),d(f,{key:1},[e("div",Ie,[e("h1",Te,o(s.$t("messages.shop.orderReceived")),1),t(y)?(l(),d("button",{key:0,type:"button",class:"inline-flex items-center justify-center p-2 bg-white border rounded-md",title:"Refresh order","aria-label":"Refresh order",onClick:Y},[u(v,{name:"ion:refresh-outline"})])):i("",!0)]),e("p",null,o(s.$t("messages.shop.orderThanks")),1)],64)):i("",!0),a[0]||(a[0]=e("hr",{class:"my-8"},null,-1))])):i("",!0),t(n)?(l(),d("div",je,[e("div",Ce,[e("div",De,[e("div",Le,o(s.$t("messages.shop.order")),1),e("div",Me,"#"+o(t(n).databaseId),1)]),e("div",Oe,[e("div",Pe,o(s.$t("messages.general.date")),1),e("div",Be,o(t(X)(t(n).date)),1)]),e("div",Ne,[e("div",Se,o(s.$t("messages.general.status")),1),t(n).status?(l(),b(se,{key:0,order:t(n)},null,8,["order"])):i("",!0)]),e("div",qe,[e("div",Ee,o(s.$t("messages.general.paymentMethod")),1),e("div",Re,o(t(n).paymentMethodTitle),1)])]),t(n).lineItems?(l(),d(f,{key:0},[a[1]||(a[1]=e("hr",{class:"my-8"},null,-1)),e("div",ze,[(l(!0),d(f,null,ve(t(n).lineItems.nodes,r=>{var j,C,D,L;return l(),d("div",{key:r.id,class:"flex items-center justify-between gap-8"},[(j=r.product)!=null&&j.node?(l(),b(T,{key:0,to:`/produkt/${r.product.node.slug}`},{default:U(()=>{var M,O,P,B,N,S,q,E,R,z,H,V,F,G,Q;return[u(te,{class:"w-16 h-16 rounded-xl",src:((P=(O=(M=r.variation)==null?void 0:M.node)==null?void 0:O.image)==null?void 0:P.sourceUrl)||((N=(B=r.product.node)==null?void 0:B.image)==null?void 0:N.sourceUrl)||"/images/placeholder.png",alt:((E=(q=(S=r.variation)==null?void 0:S.node)==null?void 0:q.image)==null?void 0:E.altText)||((z=(R=r.product.node)==null?void 0:R.image)==null?void 0:z.altText)||"Product image",title:((F=(V=(H=r.variation)==null?void 0:H.node)==null?void 0:V.image)==null?void 0:F.title)||((Q=(G=r.product.node)==null?void 0:G.image)==null?void 0:Q.title)||"Product image",width:"64",height:"64",loading:"lazy"},null,8,["src","alt","title"])]}),_:2},1032,["to"])):i("",!0),e("div",He,o(r.variation?(D=(C=r.variation)==null?void 0:C.node)==null?void 0:D.name:(L=r.product)==null?void 0:L.node.name),1),e("div",Ve,"Qty. "+o(r.quantity),1),e("span",Fe,o(t(Z)(r.total)),1)])}),128))])],64)):i("",!0),a[4]||(a[4]=e("hr",{class:"my-8"},null,-1)),t(I).length&&!t(y)?(l(),d("div",Ge,[u(oe,{downloadableItems:t(I)},null,8,["downloadableItems"]),a[2]||(a[2]=e("hr",{class:"my-8"},null,-1))])):i("",!0),e("div",null,[e("div",Qe,[e("span",null,o(s.$t("messages.shop.subtotal")),1),e("span",null,o(t(n).subtotal),1)]),e("div",Ue,[e("span",null,o(s.$t("messages.general.tax")),1),e("span",null,o(t(n).totalTax),1)]),e("div",Ae,[e("span",null,o(s.$t("messages.general.shipping")),1),e("span",null,o(t(n).shippingTotal),1)]),t(W)?(l(),d("div",Je,[e("span",null,o(s.$t("messages.shop.discount")),1),e("span",null,"- "+o(t(n).discountTotal),1)])):i("",!0),a[3]||(a[3]=e("hr",{class:"my-8"},null,-1)),e("div",Xe,[e("span",Ze,o(s.$t("messages.shop.total")),1),e("span",Ke,o(t(n).total),1)])])])):t(m)?(l(),d("div",We,[u(v,{name:"ion:sad-outline",size:"96",class:"text-gray-700"}),a[5]||(a[5]=e("h1",{class:"text-xl font-semibold"},"Error",-1)),t(m)?(l(),d("div",{key:0,class:"text-sm text-red-500",innerHTML:t(m)},null,8,Ye)):i("",!0)])):i("",!0)],64)):(l(),b(ee,{key:0,class:"flex-1"}))])}}});export{ds as default};
