import{m as $e,f as re,u as D,G as Ue,n as xe,e as De,o as Ne,h as Se,j as ke,_ as ne,b as de,q as Oe,r as Ae,k as je,a as qe,s as ze}from"./B8LMokGs.js";import{_ as Ce,a as Me}from"./DIwgtdMW.js";import{q as B,t as ue,v as m,O as t,$ as v,_ as $,Z as u,a0 as w,D as e,J as y,N as p,I as K,X as ae,W as ce,y as pe,u as Ve,P as U,d as H,c as He,a1 as Te,T as J,Q as L,ac as Be,V as F,aa as Ge,z as Re,ad as We,ae as Ye}from"./BLv-qrLK.js";import{a as Fe}from"./D9Dj-iCp.js";import"./BZpiv6Tl.js";import"./DKMn0Wwy.js";import"./DT59Ktqr.js";import"./eh08efi3.js";const Je=window.setInterval;function me(){const h=$e("orderInput",()=>({customerNote:"",paymentMethod:"",shipToDifferentAddress:!1,metaData:[{key:"order_via",value:"WooNuxt"}]})),l=$e("isProcessingOrder",()=>!1);async function r(){var d;const{customer:o,viewer:a}=re(),{isUpdatingCart:_,refreshCart:c}=D();_.value=!0;try{if(!((d=a==null?void 0:a.value)!=null&&d.id))throw new Error("Viewer ID is missing.");const{updateCustomer:x}=await Ue({input:{id:a.value.id,shipping:h.value.shipToDifferentAddress?o.value.shipping:o.value.billing,billing:o.value.billing}});x&&await c()}catch(x){console.error("Error updating shipping location:",x)}finally{_.value=!1}}async function n(o){return new Promise(a=>{const d=window.innerWidth/2-375,x=window.innerHeight/2-750/2+80,f=window.open(o,"",`width=750,height=750,top=${x},left=${d}`),b=Je(()=>{f&&f.closed&&(clearInterval(b),a(!0))},500)})}return{orderInput:h,isProcessingOrder:l,processCheckout:async(o=!1)=>{var P,z,O,X,Q,R,ee,te;const{customer:a,loginUser:_}=re(),c=xe(),{replaceQueryParam:d}=De(),{cart:x,emptyCart:f,refreshCart:b}=D();l.value=!0;const{username:j,password:Z,shipToDifferentAddress:G}=h.value,q=(P=a.value)==null?void 0:P.billing,le=G?(z=a.value)==null?void 0:z.shipping:q,N=(O=x.value)==null?void 0:O.chosenShippingMethods;try{let M={billing:q,shipping:le,shippingMethod:N,metaData:h.value.metaData,paymentMethod:h.value.paymentMethod.id,customerNote:h.value.customerNote,shipToDifferentAddress:G,transactionId:h.value.transactionId,isPaid:o};h.value.createAccount?M.account={username:j,password:Z}:M.account=null;const{checkout:i}=await Ne(M);h.value.createAccount&&await _({username:j,password:Z});const g=(X=i==null?void 0:i.order)==null?void 0:X.databaseId,S=(Q=i==null?void 0:i.order)==null?void 0:Q.orderKey,V=h.value.paymentMethod.id,A=V==="paypal"||V==="ppcp-gateway";if(i!=null&&i.order)try{localStorage.setItem("lastOrder",JSON.stringify({id:g,key:S,total:i.order.total,status:i.order.status,date:i.order.date,paymentMethod:i.order.paymentMethod,paymentMethodTitle:i.order.paymentMethodTitle}))}catch(I){console.error("Не може да се запише поръчката в localStorage",I)}if(await(i==null?void 0:i.redirect)&&A){const I=window.location.origin;let k=(i==null?void 0:i.redirect)??"";const T=`${I}/checkout/order-received/${g}/?key=${S}&from_paypal=true`,E=`${I}/checkout/?cancel_order=true&from_paypal=true`;k=d("return",T,k),k=d("cancel_return",E,k),k=d("bn","WooNuxt_Cart",k),await n(k)&&((R=a.value)!=null&&R.email&&a.value.email!=="guest"?c.push(`/checkout/order-received/${g}/?key=${S}&fetch_delay=true`):c.push("/thank-you"))}else(ee=a.value)!=null&&ee.email&&a.value.email!=="guest"?c.push(`/checkout/order-received/${g}/?key=${S}`):c.push("/thank-you");if(await(i==null?void 0:i.result)!=="success")return alert("There was an error processing your order. Please try again."),window.location.reload(),i;await f(),await b()}catch(M){const i=(te=M==null?void 0:M.gqlErrors)==null?void 0:te[0].message;return i!=null&&i.includes("An account is already registered with your email address")?(alert("An account is already registered with your email address"),null):(alert(i),null)}finally{l.value=!1}},updateShippingLocation:r}}const Ke={class:"grid w-full gap-4 lg:grid-cols-2"},Ze={class:"w-full"},Xe={for:"first-name"},Qe={class:"w-full"},et={for:"last-name"},tt={key:0,class:"w-full col-span-full"},st={for:"address1"},ot={key:1,class:"w-full col-span-full"},nt={for:"address2"},at={key:2,class:"w-full"},lt={for:"city"},it={key:3,class:"w-full"},rt={for:"state"},dt={key:4,class:"w-full"},ut={for:"country"},ct={key:5,class:"w-full"},pt={for:"zip"},mt={key:6,class:"w-full col-span-full"},ft={for:"phone"},ht=B({__name:"BillingDetails",props:{modelValue:{type:Object,required:!0}},setup(h){const{updateShippingLocation:l}=me(),{isBillingAddressEnabled:r}=D(),s=ue(h,"modelValue");return(o,a)=>{const _=Ce,c=Me;return p(),m("div",Ke,[t("div",Ze,[t("label",Xe,u(o.$t("messages.billing.firstName")),1),$(t("input",{id:"first-name","onUpdate:modelValue":a[0]||(a[0]=d=>e(s).firstName=d),placeholder:"John",autocomplete:"given-name",type:"text",required:""},null,512),[[w,e(s).firstName]])]),t("div",Qe,[t("label",et,u(o.$t("messages.billing.lastName")),1),$(t("input",{id:"last-name","onUpdate:modelValue":a[1]||(a[1]=d=>e(s).lastName=d),placeholder:"Doe",autocomplete:"family-name",type:"text",required:""},null,512),[[w,e(s).lastName]])]),e(r)?(p(),m("div",tt,[t("label",st,u(o.$t("messages.billing.address1")),1),$(t("input",{id:"address1","onUpdate:modelValue":a[2]||(a[2]=d=>e(s).address1=d),placeholder:"O'Connell Street 47",autocomplete:"street-address",type:"text",required:""},null,512),[[w,e(s).address1]])])):v("",!0),e(r)?(p(),m("div",ot,[t("label",nt,u(o.$t("messages.billing.address2"))+" ("+u(o.$t("messages.general.optional"))+")",1),$(t("input",{id:"address2","onUpdate:modelValue":a[3]||(a[3]=d=>e(s).address2=d),placeholder:"Apartment, studio, or floor",autocomplete:"address-line2",type:"text"},null,512),[[w,e(s).address2]])])):v("",!0),e(r)?(p(),m("div",at,[t("label",lt,u(o.$t("messages.billing.city")),1),$(t("input",{id:"city","onUpdate:modelValue":a[4]||(a[4]=d=>e(s).city=d),placeholder:"New York",autocomplete:"locality",type:"text",required:""},null,512),[[w,e(s).city]])])):v("",!0),e(r)?(p(),m("div",it,[t("label",rt,u(o.$t("messages.billing.state"))+" ("+u(o.$t("messages.general.optional"))+")",1),y(_,{id:"state",modelValue:e(s).state,"onUpdate:modelValue":a[5]||(a[5]=d=>e(s).state=d),"default-value":e(s).state,"country-code":e(s).country,onChange:e(l),autocomplete:"address-level1"},null,8,["modelValue","default-value","country-code","onChange"])])):v("",!0),e(r)?(p(),m("div",dt,[t("label",ut,u(o.$t("messages.billing.country")),1),y(c,{id:"country",modelValue:e(s).country,"onUpdate:modelValue":a[6]||(a[6]=d=>e(s).country=d),"default-value":e(s).country,onChange:e(l),autocomplete:"country"},null,8,["modelValue","default-value","onChange"])])):v("",!0),e(r)?(p(),m("div",ct,[t("label",pt,u(o.$t("messages.billing.zip")),1),$(t("input",{id:"zip","onUpdate:modelValue":a[7]||(a[7]=d=>e(s).postcode=d),placeholder:"10001",autocomplete:"postal-code",type:"text",required:""},null,512),[[w,e(s).postcode]])])):v("",!0),e(r)?(p(),m("div",mt,[t("label",ft,u(o.$t("messages.billing.phone"))+" ("+u(o.$t("messages.general.optional"))+")",1),$(t("input",{id:"phone","onUpdate:modelValue":a[8]||(a[8]=d=>e(s).phone=d),placeholder:"+1 234 567 8901",autocomplete:"tel",type:"tel"},null,512),[[w,e(s).phone]])])):v("",!0)])}}}),_t=Object.assign(ht,{__name:"BillingDetails"}),gt={class:"grid w-full gap-4 lg:grid-cols-2"},yt={class:"w-full"},vt={for:"first-name"},bt={class:"w-full"},$t={for:"last-name"},wt={class:"w-full col-span-full"},xt={for:"address1"},St={class:"w-full col-span-full"},kt={for:"address2"},Ct={class:"w-full"},Mt={for:"city"},Vt={class:"w-full"},Tt={for:"state"},Et={class:"w-full"},Pt={for:"country"},It={class:"w-full"},Lt={for:"zip"},Ut={class:"w-full col-span-full"},Dt={for:"phone"},Nt=B({__name:"ShippingDetails",props:{modelValue:{type:Object,required:!0}},setup(h){const{updateShippingLocation:l}=me(),n=ue(h,"modelValue");return(s,o)=>{const a=Ce,_=Me;return p(),m("div",gt,[t("div",yt,[t("label",vt,u(s.$t("messages.billing.firstName")),1),$(t("input",{id:"first-name","onUpdate:modelValue":o[0]||(o[0]=c=>e(n).firstName=c),placeholder:"John",autocomplete:"given-name",type:"text",required:""},null,512),[[w,e(n).firstName]])]),t("div",bt,[t("label",$t,u(s.$t("messages.billing.lastName")),1),$(t("input",{id:"last-name","onUpdate:modelValue":o[1]||(o[1]=c=>e(n).lastName=c),placeholder:"Doe",autocomplete:"family-name",type:"text",required:""},null,512),[[w,e(n).lastName]])]),t("div",wt,[t("label",xt,u(s.$t("messages.billing.address1")),1),$(t("input",{id:"address1","onUpdate:modelValue":o[2]||(o[2]=c=>e(n).address1=c),placeholder:"O'Connell Street 47",autocomplete:"street-address",type:"text",required:""},null,512),[[w,e(n).address1]])]),t("div",St,[t("label",kt,u(s.$t("messages.billing.address2"))+" ("+u(s.$t("messages.general.optional"))+")",1),$(t("input",{id:"address2","onUpdate:modelValue":o[3]||(o[3]=c=>e(n).address2=c),placeholder:"Apartment, studio, or floor",autocomplete:"address-line2",type:"text"},null,512),[[w,e(n).address2]])]),t("div",Ct,[t("label",Mt,u(s.$t("messages.billing.city")),1),$(t("input",{id:"city","onUpdate:modelValue":o[4]||(o[4]=c=>e(n).city=c),placeholder:"New York",autocomplete:"locality",type:"text",required:""},null,512),[[w,e(n).city]])]),t("div",Vt,[t("label",Tt,u(s.$t("messages.billing.state"))+" ("+u(s.$t("messages.general.optional"))+")",1),y(a,{id:"state",modelValue:e(n).state,"onUpdate:modelValue":o[5]||(o[5]=c=>e(n).state=c),"default-value":e(n).state,"country-code":e(n).country,onChange:e(l)},null,8,["modelValue","default-value","country-code","onChange"])]),t("div",Et,[t("label",Pt,u(s.$t("messages.billing.country")),1),y(_,{id:"country",modelValue:e(n).country,"onUpdate:modelValue":o[6]||(o[6]=c=>e(n).country=c),"default-value":e(n).country,onChange:e(l)},null,8,["modelValue","default-value","onChange"])]),t("div",It,[t("label",Lt,u(s.$t("messages.billing.zip")),1),$(t("input",{id:"zip","onUpdate:modelValue":o[7]||(o[7]=c=>e(n).postcode=c),placeholder:"10001",autocomplete:"postal-code",type:"text",required:""},null,512),[[w,e(n).postcode]])]),t("div",Ut,[t("label",Dt,u(s.$t("messages.billing.phone"))+" ("+u(s.$t("messages.general.optional"))+")",1),$(t("input",{id:"phone","onUpdate:modelValue":o[8]||(o[8]=c=>e(n).phone=c),placeholder:"+1 234 567 8901",autocomplete:"tel",type:"tel"},null,512),[[w,e(n).phone]])])])}}}),Ot=Object.assign(Nt,{__name:"ShippingDetails"}),At={class:"grid gap-4 shipping-options"},jt=["onClick"],qt=["innerHTML"],zt={class:"font-semibold text-gray-600"},Ht={__name:"ShippingOptions",props:{options:{type:Array,required:!0},activeOption:{type:String,required:!0}},setup(h){var o;const{updateShippingMethod:l}=D(),r=ke(),n=((o=r==null?void 0:r.public)==null?void 0:o.CURRENCY_SYMBOL)||"$",s=async a=>{await l(a)};return(a,_)=>{const c=ne;return p(),m("div",At,[(p(!0),m(K,null,ae(h.options,d=>(p(),m("div",{key:d.id,class:ce(["flex items-center justify-between option",{"active-option":d.id===h.activeOption}]),onClick:x=>s(d.id)},[t("div",null,[t("div",{class:"text-sm leading-tight text-gray-500",innerHTML:d.label},null,8,qt),t("div",zt,u(e(n))+u(d.cost),1)]),y(c,{name:"ion:checkmark-circle",size:"20",class:"ml-auto text-primary checkmark opacity-0"})],10,jt))),128))])}}},Bt=Se(Ht,[["__scopeId","data-v-f391d757"]]),Gt={class:"flex gap-4 leading-tight flex-wrap"},Rt=["onClick","title"],Wt=["innerHTML"],Yt={key:0,class:"prose block w-full"},Ft=["innerHTML"],Jt=B({__name:"PaymentOptions",props:{modelValue:{},paymentGateways:{}},emits:["update:modelValue"],setup(h,{emit:l}){const r=h,n=ue(r,"modelValue"),s=pe(()=>n.value),o=l,a=_=>{o("update:modelValue",_)};return Ve(()=>{var _,c;(_=r.paymentGateways)!=null&&_.nodes.length&&a((c=r.paymentGateways)==null?void 0:c.nodes[0])}),(_,c)=>{var x;const d=ne;return p(),m("div",Gt,[(p(!0),m(K,null,ae((x=_.paymentGateways)==null?void 0:x.nodes,f=>(p(),m("div",{key:f.id,class:ce(["option",{"active-option":f.id===e(s).id}]),onClick:b=>a(f),title:(f==null?void 0:f.description)||(f==null?void 0:f.title)||"Payment Method"},[f.id==="stripe"?(p(),U(d,{key:0,name:"ion:card-outline",size:"20"})):f.id==="paypal"?(p(),U(d,{key:1,name:"ion:logo-paypal",size:"20"})):(p(),U(d,{key:2,name:"ion:cash-outline",size:"20"})),t("span",{class:"whitespace-nowrap",innerHTML:f.title},null,8,Wt),y(d,{name:"ion:checkmark-circle",size:"20",class:"ml-auto text-primary checkmark opacity-0"})],10,Rt))),128)),e(s).description?(p(),m("div",Yt,[t("p",{class:"text-sm text-gray-500",innerHTML:e(s).description},null,8,Ft)])):v("",!0)])}}}),Kt=Object.assign(Se(Jt,[["__scopeId","data-v-baca1106"]]),{__name:"PaymentOptions"}),Zt={id:"card-element"},Xt=B({__name:"StripeElement",props:["stripe"],emits:["updateElement"],setup(h,{emit:l}){const{cart:r}=D(),n=pe(()=>r.value&&parseFloat(r.value.rawTotal)*100),s=l;let o=null;const a={mode:"payment",currency:"eur",amount:n.value},_=async()=>{o=h.stripe.elements(a),o.create("card",{hidePostalCode:!0}).mount("#card-element"),s("updateElement",o)};return Ve(()=>{_()}),(c,d)=>(p(),m("div",Zt))}}),Qt=Object.assign(Xt,{__name:"StripeElement"}),es=["placeholder"],ts=["disabled"],ss={key:1},os=["innerHTML"],ns={key:0,class:"text-xs font-semibold uppercase flex flex-wrap gap-2"},as={key:0,class:"bg-primary border-primary border rounded-md flex bg-opacity-5 border-opacity-10 text-primary leading-none p-1.5 gap-1 items-center"},ls=["innerHTML"],is=B({__name:"AddCoupon",setup(h){const{cart:l,isUpdatingCoupon:r,applyCoupon:n,removeCoupon:s}=D(),o=H(""),a=H("");async function _(){const{message:c}=await n(o.value);c?a.value=c:(o.value="",a.value="")}return(c,d)=>{const x=de,f=ne;return p(),m("div",null,[t("form",{class:"flex gap-1",onSubmit:Te(_,["prevent"])},[$(t("input",{id:"couponCode","onUpdate:modelValue":d[0]||(d[0]=b=>He(o)?o.value=b:null),type:"text",placeholder:c.$t("messages.shop.couponCode"),class:"w-full px-4 py-2 bg-white border border-gray-300 rounded-md shadow-sm outline-none",required:""},null,8,es),[[w,e(o)]]),t("button",{class:"flex items-center justify-center px-4 py-2 text-white bg-gray-800 border rounded-md shadow-sm outline-none min-w-20",disabled:e(r)},[e(r)?(p(),U(x,{key:0,color:"#fff",size:"16"})):(p(),m("span",ss,u(c.$t("messages.general.apply")),1))],8,ts)],32),y(J,{name:"scale-y",mode:"out-in"},{default:L(()=>[e(a)?(p(),m("div",{key:0,class:"mt-2 text-xs text-red-600",innerHTML:e(a)},null,8,os)):v("",!0)]),_:1}),y(J,{name:"scale-y",mode:"out-in"},{default:L(()=>[e(l)&&e(l).appliedCoupons?(p(),m("div",ns,[(p(!0),m(K,null,ae(e(l).appliedCoupons,(b,j)=>(p(),m("div",{key:(b==null?void 0:b.code)||j,class:"flex flex-wrap mt-2 flex-2"},[b!=null&&b.code?(p(),m("div",as,[t("span",{innerHTML:b.code},null,8,ls),y(f,{name:"ion:close",class:"rounded-full cursor-pointer hover:bg-primary hover:text-white",onClick:Z=>e(s)(b.code)},null,8,["onClick"])])):v("",!0)]))),128))])):v("",!0)]),_:1})])}}}),rs=Object.assign(is,{__name:"AddCoupon"}),ds={key:0,class:"bg-white rounded-lg shadow-lg mb-8 w-full min-h-[280px] p-4 sm:p-8 relative md:max-w-md md:top-32 md:sticky"},us={class:"mb-6 text-xl font-semibold leading-none"},cs={class:"flex flex-col gap-4 overflow-y-auto"},ps={class:"grid gap-1 text-sm font-semibold text-gray-500"},ms={class:"flex justify-between"},fs=["innerHTML"],hs={class:"flex justify-between"},_s={class:"text-gray-700 tabular-nums"},gs={key:0,class:"flex justify-between"},ys={class:"text-primary tabular-nums"},vs=["innerHTML"],bs={class:"flex justify-between mt-4"},$s=["innerHTML"],ws={key:0,class:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-50"},xs={__name:"OrderSummary",setup(h){const{cart:l,isUpdatingCart:r}=D();return(n,s)=>{const o=Fe,a=rs,_=de;return e(l)?(p(),m("aside",ds,[t("h2",us,u(n.$t("messages.shop.orderSummary")),1),t("ul",cs,[(p(!0),m(K,null,ae(e(l).contents.nodes,c=>(p(),U(o,{key:c.key,item:c},null,8,["item"]))),128))]),y(a,{class:"my-8"}),t("div",ps,[t("div",ms,[t("span",null,u(n.$t("messages.shop.subtotal")),1),t("span",{class:"text-gray-700 tabular-nums",innerHTML:e(l).subtotal},null,8,fs)]),t("div",hs,[t("span",null,u(n.$t("messages.general.shipping")),1),t("span",_s,u(parseFloat(e(l).shippingTotal)>0?"+":"")+" "+u(e(l).shippingTotal),1)]),y(J,{name:"scale-y",mode:"out-in"},{default:L(()=>[e(l)&&e(l).appliedCoupons?(p(),m("div",gs,[t("span",null,u(n.$t("messages.shop.discount")),1),t("span",ys,[s[0]||(s[0]=F("- ")),t("span",{innerHTML:e(l).discountTotal},null,8,vs)])])):v("",!0)]),_:1}),t("div",bs,[t("span",null,u(n.$t("messages.shop.total")),1),t("span",{class:"text-lg font-bold text-gray-700 tabular-nums",innerHTML:e(l).total},null,8,$s)])]),Be(n.$slots,"default"),e(r)?(p(),m("div",ws,[y(_)])):v("",!0)])):v("",!0)}}};var Ee="https://js.stripe.com/v3",Ss=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/;var ks=function(){for(var l=document.querySelectorAll('script[src^="'.concat(Ee,'"]')),r=0;r<l.length;r++){var n=l[r];if(Ss.test(n.src))return n}return null},we=function(l){var r="",n=document.createElement("script");n.src="".concat(Ee).concat(r);var s=document.head||document.body;if(!s)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return s.appendChild(n),n},Cs=function(l,r){!l||!l._registerWrapper||l._registerWrapper({name:"stripe-js",version:"4.6.0",startTime:r})},W=null,se=null,oe=null,Ms=function(l){return function(){l(new Error("Failed to load Stripe.js"))}},Vs=function(l,r){return function(){window.Stripe?l(window.Stripe):r(new Error("Stripe.js not available"))}},Ts=function(l){return W!==null?W:(W=new Promise(function(r,n){if(typeof window>"u"||typeof document>"u"){r(null);return}if(window.Stripe){r(window.Stripe);return}try{var s=ks();if(!(s&&l)){if(!s)s=we(l);else if(s&&oe!==null&&se!==null){var o;s.removeEventListener("load",oe),s.removeEventListener("error",se),(o=s.parentNode)===null||o===void 0||o.removeChild(s),s=we(l)}}oe=Vs(r,n),se=Ms(n),s.addEventListener("load",oe),s.addEventListener("error",se)}catch(a){n(a);return}}),W.catch(function(r){return W=null,Promise.reject(r)}))},Es=function(l,r,n){if(l===null)return null;var s=l.apply(void 0,r);return Cs(s,n),s},Y,Pe=!1,Ie=function(){return Y||(Y=Ts(null).catch(function(l){return Y=null,Promise.reject(l)}),Y)};Promise.resolve().then(function(){return Ie()}).catch(function(h){Pe||console.warn(h)});var Ps=function(){for(var l=arguments.length,r=new Array(l),n=0;n<l;n++)r[n]=arguments[n];Pe=!0;var s=Date.now();return Ie().then(function(o){return Es(o,r,s)})};const Is={class:"flex flex-col min-h-[600px]"},Ls={key:0,class:"flex flex-col items-center justify-center flex-1 mb-12"},Us={class:"text-2xl font-bold mb-2"},Ds={class:"text-gray-400 mb-4"},Ns={class:"grid w-full max-w-2xl gap-8 checkout-form md:flex-1"},Os={key:0},As={class:"mt-1 text-sm text-gray-500"},js={class:"w-full mt-4"},qs={for:"email"},zs={key:0,class:"mt-1 text-sm text-red-500"},Hs={class:"w-full mb-3 text-2xl font-semibold"},Bs={key:1,for:"shipToDifferentAddress",class:"flex items-center gap-2"},Gs={key:0},Rs={class:"mb-4 text-xl font-semibold"},Ws={key:2},Ys={class:"mb-4 text-xl font-semibold"},Fs={key:3,class:"mt-2 col-span-full"},Js={class:"mb-4 text-xl font-semibold"},Ks={class:"mb-4 text-xl font-semibold"},Zs=["placeholder"],Xs=["disabled"],io=B({__name:"checkout",async setup(h){var M;let l,r;const{t:n}=Oe(),{query:s}=Ae(),o=xe(),{cart:a,isUpdatingCart:_,paymentGateways:c}=D(),{customer:d,viewer:x}=re(),{orderInput:f,isProcessingOrder:b,processCheckout:j}=me(),G=((M=ke().public)==null?void 0:M.STRIPE_PUBLISHABLE_KEY)||null,q=H(b.value?n("messages.general.processing"):n("messages.shop.checkoutButton")),le=pe(()=>b.value||_.value||!f.value.paymentMethod),N=H(!1),P=G?([l,r]=Ge(()=>Ps(G)),l=await l,r(),l):null,z=H(),O=H(!1);Re(async()=>{s.cancel_order&&window.close()});const X=async()=>{var i,g;q.value=n("messages.general.processing");try{const S=(i=f.value.paymentMethod)==null?void 0:i.id;if(S==="stripe"&&P&&z.value){const{stripePaymentIntent:A}=await ze(),I=(A==null?void 0:A.clientSecret)||"",k=z.value.getElement("card"),{setupIntent:T}=await P.confirmCardSetup(I,{payment_method:{card:k}}),{source:E}=await P.createSource(k);E&&f.value.metaData.push({key:"_stripe_source_id",value:E.id}),T&&f.value.metaData.push({key:"_stripe_intent_id",value:T.id}),O.value=(T==null?void 0:T.status)==="succeeded"||!1,f.value.transactionId=((g=E==null?void 0:E.created)==null?void 0:g.toString())||new Date().getTime().toString()}else S==="cod"?(O.value=!1,f.value.transactionId=new Date().getTime().toString(),f.value.metaData.push({key:"_chosen_payment_method",value:"cash_on_delivery"})):(O.value=!1,f.value.transactionId=new Date().getTime().toString(),f.value.metaData.push({key:"_chosen_payment_method",value:S}));const V=await j(O.value);if(V!=null&&V.databaseId)o.push("/thank-you");else throw console.error("❌ Няма order.databaseId → не може да се направи redirect"),new Error("Няма order ID за redirect!")}catch(S){console.error("❌ Грешка при плащане или завършване на поръчката:",S),q.value=n("messages.shop.placeOrder")}},Q=i=>{z.value=i},R=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/,ee=i=>{i&&(N.value=!R.test(i))},te=i=>{i&&N.value&&(N.value=!R.test(i))};return je({title:n("messages.shop.checkout")}),(i,g)=>{var fe,he,_e,ge,ye,ve,be;const S=ne,V=qe,A=_t,I=Ot,k=Bt,T=Kt,E=Qt,ie=de,Le=xs;return p(),m("div",Is,[e(a)&&e(d)?(p(),m(K,{key:0},[e(a).isEmpty?(p(),m("div",Ls,[y(S,{name:"ion:cart-outline",size:"156",class:"opacity-25 mb-5"}),t("h2",Us,u(i.$t("messages.shop.cartEmpty")),1),t("span",Ds,u(i.$t("messages.shop.addProductsInYourCart")),1),y(V,{to:"/products",class:"flex items-center justify-center gap-3 p-2 px-3 mt-4 font-semibold text-center text-white rounded-lg shadow-md bg-primary hover:bg-primary-dark"},{default:L(()=>[F(u(i.$t("messages.shop.browseOurProducts")),1)]),_:1})])):(p(),m("form",{key:1,class:"container flex flex-wrap items-start gap-8 my-16 justify-evenly lg:gap-20",onSubmit:Te(X,["prevent"])},[t("div",Ns,[!e(x)&&((fe=e(d))!=null&&fe.billing)?(p(),m("div",Os,[g[6]||(g[6]=t("h2",{class:"w-full mb-2 text-2xl font-semibold leading-none"},"Contact Information",-1)),t("p",As,[F(u(i.$t("messages.account.alreadyRegistered"))+" ",1),y(V,{to:"/my-account",class:"text-primary font-semibold"},{default:L(()=>[F(u(i.$t("messages.account.login")),1)]),_:1})]),t("div",js,[t("label",qs,u(i.$t("messages.billing.email")),1),$(t("input",{"onUpdate:modelValue":g[0]||(g[0]=C=>e(d).billing.email=C),placeholder:"johndoe@email.com",autocomplete:"email",type:"email",name:"email",class:ce({"has-error":e(N)}),onBlur:g[1]||(g[1]=C=>ee(e(d).billing.email)),onInput:g[2]||(g[2]=C=>te(e(d).billing.email)),required:""},null,34),[[w,e(d).billing.email]]),y(J,{name:"scale-y",mode:"out-in"},{default:L(()=>[e(N)?(p(),m("div",zs,"Invalid email address")):v("",!0)]),_:1})])])):v("",!0),t("div",null,[t("h2",Hs,u(i.$t("messages.billing.billingDetails")),1),y(A,{"model-value":((he=e(d))==null?void 0:he.billing)||{}},null,8,["model-value"])]),e(a).availableShippingMethods&&e(a).availableShippingMethods.length>0?(p(),m("label",Bs,[t("span",null,u(i.$t("messages.billing.differentAddress")),1),$(t("input",{id:"shipToDifferentAddress","onUpdate:modelValue":g[3]||(g[3]=C=>e(f).shipToDifferentAddress=C),type:"checkbox",name:"shipToDifferentAddress"},null,512),[[We,e(f).shipToDifferentAddress]])])):v("",!0),y(J,{name:"scale-y",mode:"out-in"},{default:L(()=>{var C;return[e(f).shipToDifferentAddress?(p(),m("div",Gs,[t("h2",Rs,u(i.$t("messages.general.shippingDetails")),1),y(I,{"model-value":((C=e(d))==null?void 0:C.shipping)||{}},null,8,["model-value"])])):v("",!0)]}),_:1}),e(a).availableShippingMethods&&e(a).availableShippingMethods.length?(p(),m("div",Ws,[t("h3",Ys,u(i.$t("messages.general.shippingSelect")),1),y(k,{options:((ge=(_e=e(a).availableShippingMethods)==null?void 0:_e[0])==null?void 0:ge.rates)||[],"active-option":((ye=e(a).chosenShippingMethods)==null?void 0:ye[0])||""},null,8,["options","active-option"])])):v("",!0),(ve=e(c))!=null&&ve.nodes.length?(p(),m("div",Fs,[t("h2",Js,u(i.$t("messages.billing.paymentOptions")),1),y(T,{modelValue:e(f).paymentMethod,"onUpdate:modelValue":g[4]||(g[4]=C=>e(f).paymentMethod=C),class:"mb-4",paymentGateways:e(c)},null,8,["modelValue","paymentGateways"]),e(P)?$((p(),U(E,{key:0,stripe:e(P),onUpdateElement:Q},null,8,["stripe"])),[[Ye,((be=e(f).paymentMethod)==null?void 0:be.id)=="stripe"]]):v("",!0)])):v("",!0),t("div",null,[t("h2",Ks,u(i.$t("messages.shop.orderNote"))+" ("+u(i.$t("messages.general.optional"))+")",1),$(t("textarea",{id:"order-note","onUpdate:modelValue":g[5]||(g[5]=C=>e(f).customerNote=C),name:"order-note",class:"w-full min-h-[100px]",rows:"4",placeholder:i.$t("messages.shop.orderNotePlaceholder")},null,8,Zs),[[w,e(f).customerNote]])])]),y(Le,null,{default:L(()=>[t("button",{class:"flex items-center justify-center w-full gap-3 p-3 mt-4 font-semibold text-center text-white rounded-lg shadow-md bg-primary hover:bg-primary-dark disabled:cursor-not-allowed disabled:bg-gray-400",disabled:e(le)},[F(u(e(q)),1),e(b)?(p(),U(ie,{key:0,color:"#fff",size:"18"})):v("",!0)],8,Xs)]),_:1})],32))],64)):(p(),U(ie,{key:1,class:"m-auto"}))])}}});export{io as default};
