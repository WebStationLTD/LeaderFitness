import{_ as Y,a as ee,b as te,c as oe,d as ae,e as se}from"./2b3pExPR.js";import{v as re,e as ne,d as ce,r as le,l as R,i as ue}from"./B8LMokGs.js";import{q as ie,d as c,aa as pe,y as de,u as ge,B as L,v as I,P as y,D as i,$ as h,O as $,J as E,N as l}from"./BLv-qrLK.js";import"./CzxjUVWS.js";import"./Dv9E2zKD.js";import"./DKMn0Wwy.js";import"./DT59Ktqr.js";import"./eh08efi3.js";import"./BZpiv6Tl.js";const me={class:"container px-2"},_e={key:0,class:"flex items-start gap-16"},ye={class:"w-full"},he={class:"flex items-center justify-between w-full gap-4 mt-8 md:gap-8"};const be=ie({__name:"[slug]",async setup(fe){var v,x,k,P,w,N,B,C,S,F,V,q,D,b,M,T;let u,f;const{updateProductList:p,products:H,loadProductsForPage:O,getCurrentPageFromRoute:U}=re(),{isQueryEmpty:j}=ne(),{storeSettings:d}=ce(),e=le(),G=c(!0);console.log("Текущ route:",{fullPath:e.fullPath,path:e.path,name:e.name,params:e.params});let o="";if(e.params&&e.params.categorySlug&&(o=typeof e.params.categorySlug=="string"?e.params.categorySlug:String(e.params.categorySlug)),!o&&e.params&&e.params.slug&&(o=typeof e.params.slug=="string"?e.params.slug:String(e.params.slug)),!o&&e.path){const t=e.path.split("/"),s=t.findIndex(r=>r==="produkt-kategoriya");if(s!==-1&&t[s+1]&&t[s+1]!=="page"){const r=t[s+1];r&&(o=r)}}console.log("Извлечен slug:",o),o?console.log("Slug от URL (преди декодиране):",o):console.log("Използваме всички продукти, тъй като slug е празен");let n=o;try{o&&(n=decodeURIComponent(o),console.log("Декодиран slug:",n))}catch(t){console.error("Грешка при декодиране на URL:",t)}const g=c(o),a=c(null),m=c(""),_=c(""),{data:Q}=([u,f]=pe(()=>ue("getProductCategories")),u=await u,f(),u),J=de(()=>{var t,s;return((s=(t=Q.value)==null?void 0:t.productCategories)==null?void 0:s.nodes)||[]});g.value&&(a.value=J.value.find(t=>t.slug&&(t.slug===g.value||t.slug===n))||null,console.log("Намерена категория:",a.value));const Z={categoryIn:[g.value],search:e.query.search,priceMin:e.query.priceMin?parseFloat(e.query.priceMin):void 0,priceMax:e.query.priceMax?parseFloat(e.query.priceMax):void 0,onSale:e.query.sale==="true"?!0:void 0,orderby:e.query.orderby||"DATE"};return ge(async()=>{const t=U();await O(t,Z),j.value||p()}),setTimeout(()=>{G.value=!1},500),L(()=>e.query,()=>{e.name!=="produkt-kategoriya-slug"&&e.name!=="produkt-kategoriya-page-pager"||p()}),L(()=>e.params,()=>{e.name!=="produkt-kategoriya-slug"&&e.name!=="produkt-kategoriya-page-pager"||p()}),m.value=((x=(v=a.value)==null?void 0:v.seo)==null?void 0:x.title)||((k=a.value)==null?void 0:k.name)||n||"All Products",_.value=((w=(P=a.value)==null?void 0:P.seo)==null?void 0:w.metaDesc)||((N=a.value)==null?void 0:N.description)||`Products in category ${((B=a.value)==null?void 0:B.name)||n||"All Products"}`,R({title:m.value,meta:[{name:"description",content:_.value},{property:"og:title",content:((S=(C=a.value)==null?void 0:C.seo)==null?void 0:S.opengraphTitle)||m.value},{property:"og:description",content:((V=(F=a.value)==null?void 0:F.seo)==null?void 0:V.opengraphDescription)||_.value}],link:[{rel:"canonical",href:((D=(q=a.value)==null?void 0:q.seo)==null?void 0:D.canonical)||""}]}),(T=(M=(b=a.value)==null?void 0:b.seo)==null?void 0:M.schema)!=null&&T.raw&&R({script:[{type:"application/ld+json",innerHTML:a.value.seo.schema.raw}]}),(t,s)=>{var A;const r=oe,z=ee,K=ae,W=se,X=te,ve=Y;return l(),I("div",me,[((A=i(H))!=null&&A.length,l(),I("div",_e,[i(d).showFilters?(l(),y(r,{key:0,"hide-categories":!0})):h("",!0),$("div",ye,[$("div",he,[E(z),i(d).showOrderByDropdown?(l(),y(K,{key:0,class:"hidden md:inline-flex"})):h("",!0),i(d).showFilters?(l(),y(W,{key:1,class:"md:hidden"})):h("",!0)]),E(X)])]))])}}});export{be as default};
