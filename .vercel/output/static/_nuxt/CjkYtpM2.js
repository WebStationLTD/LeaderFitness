import{_ as B,a as I,b as L,c as R,d as E,e as V}from"./DZ3TSjdJ.js";import{d as $,a8 as H,n as U,m as j,X as G,B as y,K as M,C as O,z,I as C,c as m,h,a as p,i as b,e as a,b as D,w as K,o as c,t as F,g as N}from"./BFrj2aVI.js";import"./CD5_m4RY.js";import"./C-8UdED7.js";import"./wNlFRyfG.js";import"./BGNol3OQ.js";const Q={class:"container px-2"},X={key:0,class:"flex items-start gap-16"},J={class:"w-full"},W={class:"flex items-center justify-between w-full gap-4 mt-8 md:gap-8"},Y={key:1,class:"py-16 text-center"},Z={class:"text-center"},ee={class:"text-xl font-bold mb-4"},te={key:0,class:"mt-4 text-sm text-gray-600 border p-4 rounded text-left inline-block"},re={key:1,class:"mt-4 text-sm text-gray-600"},ue=$({__name:"[slug]",setup(oe){const{loadProductsForPage:x,updateProductList:k,products:S,getCurrentPageFromRoute:q}=H(),{isQueryEmpty:A}=U(),{storeSettings:P}=j(),e=G(),w=y(!0);let n="";if(e.params&&e.params.categorySlug&&(n=typeof e.params.categorySlug=="string"?e.params.categorySlug:String(e.params.categorySlug)),!n&&e.params&&e.params.slug&&(n=typeof e.params.slug=="string"?e.params.slug:String(e.params.slug)),!n&&e.path){const s=e.path.split("/"),t=s.findIndex(l=>l==="produkt-kategoriya");if(t!==-1&&s[t+1]&&s[t+1]!=="page"){const l=s[t+1];l&&(n=l)}}let u=n;try{n&&(u=decodeURIComponent(n))}catch(s){console.error("Грешка при декодиране на URL:",s)}const d=y(n),r=y(null),v=y(u||"All Products"),_=y(`Products in category ${u||"All Products"}`);return M({title:v.value,meta:[{name:"description",content:_.value}]}),O(async()=>{var s,t,l,f;try{const{data:o}=await z("getProductCategories"),i=((t=(s=o.value)==null?void 0:s.productCategories)==null?void 0:t.nodes)||[];d.value&&(r.value=i.find(g=>g.slug&&(g.slug===d.value||g.slug===u))||null),(l=r.value)!=null&&l.seo&&(v.value=r.value.seo.title||r.value.name||u||"All Products",_.value=r.value.seo.metaDesc||r.value.description||`Products in category ${r.value.name||u||"All Products"}`,M({title:v.value,meta:[{name:"description",content:_.value},{property:"og:title",content:r.value.seo.opengraphTitle||v.value},{property:"og:description",content:r.value.seo.opengraphDescription||_.value}],link:[{rel:"canonical",href:r.value.seo.canonical||""}]}),(f=r.value.seo.schema)!=null&&f.raw&&M({script:[{type:"application/ld+json",innerHTML:r.value.seo.schema.raw}]}))}catch(o){console.warn("Не можахме да заредим категориите (очаквано при първо зареждане):",o)}try{if(r.value&&r.value.slug){const o={categoryIn:[r.value.slug],search:e.query.search,priceMin:e.query.priceMin?parseFloat(e.query.priceMin):void 0,priceMax:e.query.priceMax?parseFloat(e.query.priceMax):void 0,onSale:e.query.sale==="true"?!0:void 0,orderby:e.query.orderby||"DATE"},i=q();await x(i,o)}else if(d.value){const o={categoryIn:[d.value],search:e.query.search,priceMin:e.query.priceMin?parseFloat(e.query.priceMin):void 0,priceMax:e.query.priceMax?parseFloat(e.query.priceMax):void 0,onSale:e.query.sale==="true"?!0:void 0,orderby:e.query.orderby||"DATE"},i=q();await x(i,o)}else{const o={search:e.query.search,priceMin:e.query.priceMin?parseFloat(e.query.priceMin):void 0,priceMax:e.query.priceMax?parseFloat(e.query.priceMax):void 0,onSale:e.query.sale==="true"?!0:void 0,orderby:e.query.orderby||"DATE"},i=q();await x(i,o)}A.value||k()}catch(o){console.error("Грешка при зареждане на продукти:",o)}w.value=!1}),C(()=>e.query,()=>{e.name!=="produkt-kategoriya-slug"&&e.name!=="produkt-kategoriya-page-pager"||k()}),C(()=>e.params,()=>{e.name!=="produkt-kategoriya-slug"&&e.name!=="produkt-kategoriya-page-pager"||k()}),(s,t)=>{const l=R,f=I,o=E,i=V,g=L,T=B;return c(),m("div",Q,[!w.value&&p(S)&&p(S).length?(c(),m("div",X,[p(P).showFilters?(c(),h(l,{key:0,"hide-categories":!0})):b("",!0),a("div",J,[a("div",W,[D(f),p(P).showOrderByDropdown?(c(),h(o,{key:0,class:"hidden md:inline-flex"})):b("",!0),p(P).showFilters?(c(),h(i,{key:1,class:"md:hidden"})):b("",!0)]),D(g)])])):w.value?(c(),m("div",Y,t[0]||(t[0]=[a("div",{class:"inline-block p-4 text-gray-500"},[a("div",{class:"h-8 w-8 border-t-2 border-primary border-solid rounded-full mx-auto animate-spin mb-4"}),a("p",null,"Loading products...")],-1)]))):(c(),h(T,{key:2},{default:K(()=>[a("div",Z,[a("h2",ee,F(d.value?"No products found in this category.":"All Products"),1),d.value?(c(),m("div",te,[a("p",null,[t[1]||(t[1]=a("strong",null,"URL slug:",-1)),N(" "+F(d.value||"Not provided"),1)]),a("p",null,[t[2]||(t[2]=a("strong",null,"Decoded slug:",-1)),N(" "+F(p(u)||"Not decoded"),1)])])):(c(),m("div",re,t[3]||(t[3]=[a("p",null,"Please select a category from the menu.",-1)])))])]),_:1}))])}}});export{ue as default};
