import{_ as e,a as r,b as o,c as t,d as l,e as a}from"./ProductGrid-Bl8WhHln.mjs";import{defineComponent as s,ref as i,withAsyncContext as u,computed as n,watch as d,mergeProps as p,unref as c,withCtx as v,createVNode as m,createBlock as g,toDisplayString as y,openBlock as h,createTextVNode as x,useSSRContext as f}from"vue";import{ssrRenderAttrs as b,ssrRenderComponent as q,ssrInterpolate as M}from"vue/server-renderer";import{z as k,e as P,d as w,w as $,i as S,l as j}from"./server.mjs";import"./default-C7s0JCB3.mjs";import"graphql-request";import"./ProductCard-SaerHacm.mjs";import"./NuxtImg-BJG_EbHe.mjs";import"./ProductPrice-BLA-t2Nu.mjs";import"../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"consola";import"@iconify/utils";import"node:crypto";import"node:url";import"ipx";import"node:fs";import"node:path";import"vue-router";import"@iconify/vue";import"@heroicons/vue/24/outline";import"@iconify/utils/lib/css/icon";import"@headlessui/vue";import"@heroicons/vue/20/solid";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"devalue";import"unhead/plugins";import"unhead/utils";const F=s({__name:"[slug]",__ssrInlineRender:!0,async setup(s){var f,F,_,A,D,L,N,C,R,I,T,B,U,E,H,G;let J,z;const{updateProductList:O,products:W,loadProductsForPage:K,getCurrentPageFromRoute:Q}=k();P();const{storeSettings:V}=w(),X=$(),Y=i(!0);console.log("Текущ route:",{fullPath:X.fullPath,path:X.path,name:X.name,params:X.params});let Z="";if(X.params&&X.params.categorySlug&&(Z="string"==typeof X.params.categorySlug?X.params.categorySlug:String(X.params.categorySlug)),!Z&&X.params&&X.params.slug&&(Z="string"==typeof X.params.slug?X.params.slug:String(X.params.slug)),!Z&&X.path){const e=X.path.split("/"),r=e.findIndex((e=>"produkt-kategoriya"===e));if(-1!==r&&e[r+1]&&"page"!==e[r+1]){const o=e[r+1];o&&(Z=o)}}console.log("Извлечен slug:",Z),Z?console.log("Slug от URL (преди декодиране):",Z):console.log("Използваме всички продукти, тъй като slug е празен");let ee=Z;try{Z&&(ee=decodeURIComponent(Z),console.log("Декодиран slug:",ee))}catch(e){console.error("Грешка при декодиране на URL:",e)}const re=i(Z),oe=i(null),te=i(""),le=i(""),{data:ae}=([J,z]=u((()=>S("getProductCategories"))),J=await J,z(),J),se=n((()=>{var e,r;return(null==(r=null==(e=ae.value)?void 0:e.productCategories)?void 0:r.nodes)||[]}));if(re.value&&(oe.value=se.value.find((e=>e.slug&&(e.slug===re.value||e.slug===ee)))||null,console.log("Намерена категория:",oe.value)),oe.value&&oe.value.slug)try{const e={categoryIn:[oe.value.slug],search:X.query.search,priceMin:X.query.priceMin?parseFloat(X.query.priceMin):void 0,priceMax:X.query.priceMax?parseFloat(X.query.priceMax):void 0,onSale:"true"===X.query.sale||void 0,orderby:X.query.orderby||"DATE"},r=Q();[J,z]=u((()=>K(r,e))),await J,z(),console.log(`Заредени продукти от категория ${oe.value.slug} с pagination`)}catch(e){console.error("Грешка при зареждане на продукти:",e)}else if(re.value)try{const e={categoryIn:[re.value],search:X.query.search,priceMin:X.query.priceMin?parseFloat(X.query.priceMin):void 0,priceMax:X.query.priceMax?parseFloat(X.query.priceMax):void 0,onSale:"true"===X.query.sale||void 0,orderby:X.query.orderby||"DATE"},r=Q();[J,z]=u((()=>K(r,e))),await J,z()}catch(e){console.error("Грешка при зареждане на продукти по slug:",e)}else try{const e={search:X.query.search,priceMin:X.query.priceMin?parseFloat(X.query.priceMin):void 0,priceMax:X.query.priceMax?parseFloat(X.query.priceMax):void 0,onSale:"true"===X.query.sale||void 0,orderby:X.query.orderby||"DATE"},r=Q();[J,z]=u((()=>K(r,e))),await J,z()}catch(e){console.error("Грешка при зареждане на всички продукти:",e)}return setTimeout((()=>{Y.value=!1}),500),d((()=>X.query),(()=>{"produkt-kategoriya-slug"!==X.name&&"produkt-kategoriya-page-pager"!==X.name||O()})),d((()=>X.params),(()=>{"produkt-kategoriya-slug"!==X.name&&"produkt-kategoriya-page-pager"!==X.name||O()})),te.value=(null==(F=null==(f=oe.value)?void 0:f.seo)?void 0:F.title)||(null==(_=oe.value)?void 0:_.name)||ee||"All Products",le.value=(null==(D=null==(A=oe.value)?void 0:A.seo)?void 0:D.metaDesc)||(null==(L=oe.value)?void 0:L.description)||`Products in category ${(null==(N=oe.value)?void 0:N.name)||ee||"All Products"}`,j({title:te.value,meta:[{name:"description",content:le.value},{property:"og:title",content:(null==(R=null==(C=oe.value)?void 0:C.seo)?void 0:R.opengraphTitle)||te.value},{property:"og:description",content:(null==(T=null==(I=oe.value)?void 0:I.seo)?void 0:T.opengraphDescription)||le.value}],link:[{rel:"canonical",href:(null==(U=null==(B=oe.value)?void 0:B.seo)?void 0:U.canonical)||""}]}),(null==(G=null==(H=null==(E=oe.value)?void 0:E.seo)?void 0:H.schema)?void 0:G.raw)&&j({script:[{type:"application/ld+json",innerHTML:oe.value.seo.schema.raw}]}),(s,i,u,n)=>{const d=e,f=r,k=o,P=t,w=l,$=a;i(`<div${b(p({class:"container px-2"},n))}>`),!Y.value&&c(W)&&c(W).length?(i('<div class="flex items-start gap-16">'),c(V).showFilters?i(q(d,{"hide-categories":!0},null,u)):i("\x3c!----\x3e"),i('<div class="w-full"><div class="flex items-center justify-between w-full gap-4 mt-8 md:gap-8">'),i(q(f,null,null,u)),c(V).showOrderByDropdown?i(q(k,{class:"hidden md:inline-flex"},null,u)):i("\x3c!----\x3e"),c(V).showFilters?i(q(P,{class:"md:hidden"},null,u)):i("\x3c!----\x3e"),i("</div>"),i(q(w,null,null,u)),i("</div></div>")):Y.value?i('<div class="py-16 text-center"><div class="inline-block p-4 text-gray-500"><div class="h-8 w-8 border-t-2 border-primary border-solid rounded-full mx-auto animate-spin mb-4"></div><p>Loading products...</p></div></div>'):i(q($,null,{default:v(((e,r,o,t)=>{if(!r)return[m("div",{class:"text-center"},[m("h2",{class:"text-xl font-bold mb-4"},y(re.value?"No products found in this category.":"All Products"),1),re.value?(h(),g("div",{key:0,class:"mt-4 text-sm text-gray-600 border p-4 rounded text-left inline-block"},[m("p",null,[m("strong",null,"URL slug:"),x(" "+y(re.value||"Not provided"),1)]),m("p",null,[m("strong",null,"Decoded slug:"),x(" "+y(c(ee)||"Not decoded"),1)])])):(h(),g("div",{key:1,class:"mt-4 text-sm text-gray-600"},[m("p",null,"Please select a category from the menu.")]))])];r(`<div class="text-center"${t}><h2 class="text-xl font-bold mb-4"${t}>${M(re.value?"No products found in this category.":"All Products")}</h2>`),re.value?r(`<div class="mt-4 text-sm text-gray-600 border p-4 rounded text-left inline-block"${t}><p${t}><strong${t}>URL slug:</strong> ${M(re.value||"Not provided")}</p><p${t}><strong${t}>Decoded slug:</strong> ${M(c(ee)||"Not decoded")}</p></div>`):r(`<div class="mt-4 text-sm text-gray-600"${t}><p${t}>Please select a category from the menu.</p></div>`),r("</div>")})),_:1},u)),i("</div>")}}}),_=F.setup;F.setup=(e,r)=>{const o=f();return(o.modules||(o.modules=new Set)).add("woonuxt_base/app/pages/produkt-kategoriya/[slug].vue"),_?_(e,r):void 0};export{F as default};
//# sourceMappingURL=_slug_-DQBY3TUn.mjs.map
