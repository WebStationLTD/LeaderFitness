import{l as e,i as t,c as s,h as a}from"./server.mjs";import{defineComponent as o,withAsyncContext as l,mergeProps as n,unref as r,ref as i,reactive as d,withCtx as u,createVNode as c,createBlock as p,openBlock as v,createCommentVNode as m,toDisplayString as g,createTextVNode as x,Fragment as f,renderList as h,useSSRContext as y}from"vue";import{ssrRenderAttrs as b,ssrInterpolate as $,ssrRenderList as w,ssrRenderComponent as P,ssrRenderAttr as I,ssrIncludeBooleanAttr as _}from"vue/server-renderer";import"../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"graphql-request";import"consola";import"@iconify/utils";import"node:crypto";import"node:url";import"ipx";import"node:fs";import"node:path";import"vue-router";import"@iconify/vue";import"@heroicons/vue/24/outline";import"@iconify/utils/lib/css/icon";import"@headlessui/vue";import"@heroicons/vue/20/solid";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"devalue";import"unhead/plugins";import"unhead/utils";const j=o({__name:"BlogPostCard",__ssrInlineRender:!0,props:{post:{type:Object,required:!0}},setup(e){const formatDate=e=>{if(!e)return"";const t=new Date(e);return new Intl.DateTimeFormat("bg-BG",{year:"numeric",month:"long",day:"numeric"}).format(t)},formatExcerpt=e=>{if(!e)return"";const t=e.replace(/<\/?[^>]+(>|$)/g,"").replace(/\[&hellip;\]|\[…\]/g,"...");return t.length>150?t.slice(0,150)+"...":t};return(t,s,o,l)=>{const r=a;s(`<article${b(n({class:"flex flex-col overflow-hidden rounded-lg shadow transition-all hover:shadow-lg"},l))} data-v-c2845411>`),s(P(r,{to:`/blog/${e.post.slug}`,class:"block overflow-hidden"},{default:u(((t,s,a,o)=>{var l,n,r,i,d,u,y,b,P,_,j,k;if(!s)return[c("div",{class:"aspect-w-16 aspect-h-9 w-full relative"},[(null==(b=null==(y=e.post.featuredImage)?void 0:y.node)?void 0:b.sourceUrl)?(v(),p("img",{key:0,src:e.post.featuredImage.node.sourceUrl,alt:e.post.featuredImage.node.altText||e.post.title,class:"h-48 w-full object-cover transition-transform duration-200 ease-in-out hover:scale-105"},null,8,["src","alt"])):(v(),p("div",{key:1,class:"h-48 w-full bg-gray-200 flex items-center justify-center"},[c("span",{class:"text-gray-400"},"Няма изображение")]))]),c("div",{class:"flex-1 bg-white p-6 flex flex-col justify-between"},[c("div",{class:"flex-1"},[c("div",{class:"flex items-center gap-2 text-sm text-gray-500 mb-2"},[e.post.date?(v(),p("time",{key:0,datetime:e.post.date},g(formatDate(e.post.date)),9,["datetime"])):m("",!0),(null==(_=null==(P=e.post.categories)?void 0:P.nodes)?void 0:_.length)?(v(),p("span",{key:1,class:"inline-flex"},[x(" • "),(v(!0),p(f,null,h(e.post.categories.nodes,((t,s)=>(v(),p("span",{key:t.slug,class:"ml-1"},g(t.name)+g(s<e.post.categories.nodes.length-1?", ":""),1)))),128))])):m("",!0)]),c("h3",{class:"text-xl font-semibold text-gray-900 hover:text-primary-600"},g(e.post.title),1),e.post.excerpt?(v(),p("div",{key:0,class:"mt-3 text-gray-600"},g(formatExcerpt(e.post.excerpt)),1)):m("",!0)]),c("div",{class:"mt-4"},[(null==(j=e.post.author)?void 0:j.node)?(v(),p("div",{key:0,class:"flex items-center"},[(null==(k=e.post.author.node.avatar)?void 0:k.url)?(v(),p("div",{key:0,class:"flex-shrink-0 mr-2"},[c("img",{class:"h-8 w-8 rounded-full",src:e.post.author.node.avatar.url,alt:e.post.author.node.name},null,8,["src","alt"])])):m("",!0),e.post.author.node.name?(v(),p("p",{key:1,class:"text-sm font-medium text-gray-900"},g(e.post.author.node.name),1)):m("",!0)])):m("",!0)])])];s(`<div class="aspect-w-16 aspect-h-9 w-full relative" data-v-c2845411${o}>`),(null==(n=null==(l=e.post.featuredImage)?void 0:l.node)?void 0:n.sourceUrl)?s(`<img${I("src",e.post.featuredImage.node.sourceUrl)}${I("alt",e.post.featuredImage.node.altText||e.post.title)} class="h-48 w-full object-cover transition-transform duration-200 ease-in-out hover:scale-105" data-v-c2845411${o}>`):s(`<div class="h-48 w-full bg-gray-200 flex items-center justify-center" data-v-c2845411${o}><span class="text-gray-400" data-v-c2845411${o}>Няма изображение</span></div>`),s(`</div><div class="flex-1 bg-white p-6 flex flex-col justify-between" data-v-c2845411${o}><div class="flex-1" data-v-c2845411${o}><div class="flex items-center gap-2 text-sm text-gray-500 mb-2" data-v-c2845411${o}>`),e.post.date?s(`<time${I("datetime",e.post.date)} data-v-c2845411${o}>${$(formatDate(e.post.date))}</time>`):s("\x3c!----\x3e"),(null==(i=null==(r=e.post.categories)?void 0:r.nodes)?void 0:i.length)?(s(`<span class="inline-flex" data-v-c2845411${o}> • \x3c!--[--\x3e`),w(e.post.categories.nodes,((t,a)=>{s(`<span class="ml-1" data-v-c2845411${o}>${$(t.name)}${$(a<e.post.categories.nodes.length-1?", ":"")}</span>`)})),s("\x3c!--]--\x3e</span>")):s("\x3c!----\x3e"),s(`</div><h3 class="text-xl font-semibold text-gray-900 hover:text-primary-600" data-v-c2845411${o}>${$(e.post.title)}</h3>`),e.post.excerpt?s(`<div class="mt-3 text-gray-600" data-v-c2845411${o}>${$(formatExcerpt(e.post.excerpt))}</div>`):s("\x3c!----\x3e"),s(`</div><div class="mt-4" data-v-c2845411${o}>`),(null==(d=e.post.author)?void 0:d.node)?(s(`<div class="flex items-center" data-v-c2845411${o}>`),(null==(u=e.post.author.node.avatar)?void 0:u.url)?s(`<div class="flex-shrink-0 mr-2" data-v-c2845411${o}><img class="h-8 w-8 rounded-full"${I("src",e.post.author.node.avatar.url)}${I("alt",e.post.author.node.name)} data-v-c2845411${o}></div>`):s("\x3c!----\x3e"),e.post.author.node.name?s(`<p class="text-sm font-medium text-gray-900" data-v-c2845411${o}>${$(e.post.author.node.name)}</p>`):s("\x3c!----\x3e"),s("</div>")):s("\x3c!----\x3e"),s("</div></div>")})),_:1},o)),s("</article>")}}}),k=j.setup;j.setup=(e,t)=>{const s=y();return(s.modules||(s.modules=new Set)).add("components/blog/BlogPostCard.vue"),k?k(e,t):void 0};const B=Object.assign(s(j,[["__scopeId","data-v-c2845411"]]),{__name:"BlogPostCard"}),useBlog=()=>{const e=i([]),s=i(null),a=i(!1),o=i(null),l=d({hasNextPage:!1,endCursor:null}),addPosts=t=>{t&&t.length>0&&(e.value=[...e.value,...t])},setCurrentPost=e=>{s.value=e};return{posts:e,currentPost:s,loading:a,error:o,pageInfo:l,setPosts:t=>{t&&t.length>0&&(e.value=t)},addPosts:addPosts,setCurrentPost:setCurrentPost,loadMorePosts:async()=>{var e,s;if(l.hasNextPage){a.value=!0,o.value=null;try{const{data:a}=await t("GetBlogPosts",{first:12,after:l.endCursor});(null==(s=null==(e=a.value)?void 0:e.posts)?void 0:s.nodes)&&(addPosts(a.value.posts.nodes),l.hasNextPage=a.value.posts.pageInfo.hasNextPage,l.endCursor=a.value.posts.pageInfo.endCursor)}catch(e){o.value=e.message||"Грешка при зареждане на публикации"}finally{a.value=!1}}},loadPostBySlug:async e=>{var s,l,n,r;a.value=!0,o.value=null;try{const{data:a}=await t("GetBlogPosts",{first:100}),o=null==(n=null==(l=null==(s=a.value)?void 0:s.posts)?void 0:l.nodes)?void 0:n.find((t=>t.slug===e));if(o){const{data:e}=await t("GetBlogPost",{id:o.id});if(null==(r=e.value)?void 0:r.post)return setCurrentPost(e.value.post),e.value.post}return null}catch(e){return o.value=e.message||"Грешка при зареждане на публикацията",null}finally{a.value=!1}}}},C=o({__name:"BlogPagination",__ssrInlineRender:!0,setup(e){const{loading:t,pageInfo:s}=useBlog();return(e,a,o,l)=>{r(s).hasNextPage?(a(`<div${b(n({class:"w-full mt-8 flex justify-center"},l))}><button${_(r(t))?" disabled":""} class="rounded-lg px-4 py-2 bg-primary-600 text-white hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed">`),r(t)?a("<span>Зареждане...</span>"):a("<span>Зареди още</span>"),a("</button></div>")):a("\x3c!----\x3e")}}}),G=C.setup;C.setup=(e,t)=>{const s=y();return(s.modules||(s.modules=new Set)).add("components/blog/BlogPagination.vue"),G?G(e,t):void 0};const N=Object.assign(C,{__name:"BlogPagination"}),S=o({__name:"index",__ssrInlineRender:!0,async setup(s){var a,o;let i,d;const{setPosts:u,posts:c,pageInfo:p}=useBlog();let v="Блог";e({title:v,meta:[{name:"description",content:"Всички публикации от нашия блог"}]});try{const{data:e}=([i,d]=l((()=>t("GetBlogPosts",{first:50}))),i=await i,d(),i);(null==(o=null==(a=e.value)?void 0:a.posts)?void 0:o.nodes)&&(u(e.value.posts.nodes),e.value.posts.pageInfo&&(p.hasNextPage=e.value.posts.pageInfo.hasNextPage,p.endCursor=e.value.posts.pageInfo.endCursor))}catch(e){console.error("Грешка при зареждане на публикации:",e)}return(e,t,s,a)=>{const o=B,l=N;t(`<div${b(n({class:"container py-8"},a))}><h1 class="text-3xl sm:text-4xl font-bold text-center mb-8">${$(r(v))}</h1>`),r(c).length?(t('<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">\x3c!--[--\x3e'),w(r(c),(e=>{t(P(o,{key:e.id,post:e},null,s))})),t("\x3c!--]--\x3e</div>")):t('<div class="text-center p-8"><h2 class="text-xl font-semibold">Няма намерени публикации</h2><p class="mt-2 text-gray-600">В момента няма публикации в блога</p><div class="mt-8 p-4 bg-yellow-50 rounded-lg text-left"><p class="font-semibold">Възможни причини:</p><ul class="list-disc pl-5 mt-2"><li>WPGraphQL плъгинът не е активиран</li><li>Публикациите (posts) не са достъпни през GraphQL API</li><li>Постовете са с неправилен статус (трябва да са published)</li><li>Има проблем с GraphQL ендпойнта или достъпа до него</li></ul></div></div>'),r(c).length&&r(p).hasNextPage?t(P(l,null,null,s)):t("\x3c!----\x3e"),t("</div>")}}}),U=S.setup;S.setup=(e,t)=>{const s=y();return(s.modules||(s.modules=new Set)).add("pages/blog/index.vue"),U?U(e,t):void 0};export{S as default};
//# sourceMappingURL=index-Ca0zcy5g.mjs.map
